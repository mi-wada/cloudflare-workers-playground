<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OjisanifyğŸ˜˜</title>
  </head>
  <body>
    <header>
      <h1 id="heading">OjisanifyğŸ˜˜</h1>
    </header>
    <main>
      <textarea
        id="input"
        placeholder="å¤‰æ›ã—ãŸã„æ–‡ç« ã‚’å…¥åŠ›"
        rows="3"
        style="width: 100%; resize: vertical"
      ></textarea>
      <button id="btn">å¤‰æ›</button>
      <div
        id="result"
        style="white-space: pre-wrap; word-break: break-all"
      ></div>
    </main>
    <script>
      function getQueryParam(name) {
        const params = new URLSearchParams(window.location.search);
        return params.get(name);
      }

      const input = document.getElementById("input");
      const btn = document.getElementById("btn");
      const result = document.getElementById("result");

      async function ojisanify(q) {
        // å…¥åŠ›æ¬„ã®å†…å®¹ã§URLã®qãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°
        const url = new URL(window.location);
        url.searchParams.set("q", q);
        window.history.replaceState(null, "", url);
        result.textContent = "å¤‰æ›ä¸­...";
        const res = await fetch(`/api?q=${encodeURIComponent(q)}`);
        const data = await res.json();
        result.textContent = data.response || data;
      }

      // åˆæœŸè¡¨ç¤ºã§qãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å…¥åŠ›æ¬„ã«åæ˜ ã—ã€å³å¤‰æ›
      const initialQ = getQueryParam("q");
      if (initialQ) {
        input.value = initialQ;
        ojisanify(initialQ);
      }

      btn.onclick = function () {
        ojisanify(input.value);
      };
    </script>
  </body>
</html>
